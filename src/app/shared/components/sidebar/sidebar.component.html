<div class="sidebar-modern p-2 h-100">
  <ul class="nav flex-column sidebar-list">
    <ng-container *ngFor="let item of allowedMenuItems">
      <li class="nav-item mb-2 sidebar-dropdown" *ngIf="item.children && item.children.length > 0; else singleItem">
        <button class="btn sidebar-dropdown-toggle w-100 d-flex align-items-center justify-content-between" type="button"
          (click)="item.label === 'Dashboard' ? dashboardOpen = !dashboardOpen :
                   item.label === 'User Management' ? usersOpen = !usersOpen :
                   item.label === 'Role Management' ? rolesOpen = !rolesOpen :
                   item.label === 'System Management' ? systemOpen = !systemOpen :
                   item.label === 'Settings' ? settingsOpen = !settingsOpen : null"
          [attr.aria-expanded]="item.label === 'Dashboard' ? dashboardOpen :
                                item.label === 'User Management' ? usersOpen :
                                item.label === 'Role Management' ? rolesOpen :
                                item.label === 'System Management' ? systemOpen :
                                item.label === 'Settings' ? settingsOpen : false">
          <span class="d-flex align-items-center">
            <span class="me-2"><i class="bi" [ngClass]="item.icon"></i></span> {{ item.label }}
          </span>
          <i class="bi" [ngClass]="{
            'bi-chevron-down': (item.label === 'Dashboard' && dashboardOpen) ||
                              (item.label === 'User Management' && usersOpen) ||
                              (item.label === 'Role Management' && rolesOpen) ||
                              (item.label === 'System Management' && systemOpen) ||
                              (item.label === 'Settings' && settingsOpen),
            'bi-chevron-right': !( (item.label === 'Dashboard' && dashboardOpen) ||
                                   (item.label === 'User Management' && usersOpen) ||
                                   (item.label === 'Role Management' && rolesOpen) ||
                                   (item.label === 'System Management' && systemOpen) ||
                                   (item.label === 'Settings' && settingsOpen) ),
            'arrow-icon': true
          }"></i>
        </button>
        <div class="sidebar-dropdown-menu" [class.show]="
          (item.label === 'Dashboard' && dashboardOpen) ||
          (item.label === 'User Management' && usersOpen) ||
          (item.label === 'Role Management' && rolesOpen) ||
          (item.label === 'System Management' && systemOpen) ||
          (item.label === 'Settings' && settingsOpen)">
          <a *ngFor="let child of item.children" class="dropdown-item nav-link" [routerLink]="child.route" routerLinkActive="active" [routerLinkActiveOptions]="{ exact: true }">
            <i class="bi me-2" [ngClass]="child.icon"></i> {{ child.label }}
          </a>
        </div>
      </li>
      <ng-template #singleItem>
        <li class="nav-item mb-2" *ngIf="!item.children">
          <a class="nav-link d-flex align-items-center" [routerLink]="item.route" routerLinkActive="active" [routerLinkActiveOptions]="{ exact: true }">
            <i class="bi me-2" [ngClass]="item.icon"></i> {{ item.label }}
          </a>
        </li>
      </ng-template>
    </ng-container>
  </ul>
</div>
